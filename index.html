<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Block Hide Number</title>
<style>
    body {
        margin: 0;
        background: black;
        overflow: hidden;
        font-family: monospace;
        color: white;
    }
    .block {
        position: absolute;
        width: 80px;
        height: 80px;
        border: 3px solid white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 48px;
        box-sizing: border-box;
        transform-origin: center center;
    }
    .number {
        position: absolute;
        width: 100%;
        text-align: center;
        font-size: 22px;
        top: -30px;
        opacity: 1;
        transition: opacity 0.2s linear;
        pointer-events: none;
    }
</style>
</head>
<body>

<script>
const BLOCK_COUNT = 50;
const blockSize = 80;

// -------------- 重なり防止ランダム配置 --------------
function generateNonOverlappingPositions(count) {
    const list = [];
    const maxAttempts = 2000;

    for (let i = 0; i < count; i++) {
        let x, y, ok = false;
        let tries = 0;

        while (!ok && tries < maxAttempts) {
            tries++;

            x = Math.random() * (window.innerWidth - blockSize - 20);
            y = Math.random() * (window.innerHeight - blockSize - 20);

            ok = true;

            for (let b of list) {
                if (
                    x < b.x + blockSize + 10 &&
                    x + blockSize + 10 > b.x &&
                    y < b.y + blockSize + 10 &&
                    y + blockSize + 10 > b.y
                ) {
                    ok = false;
                    break;
                }
            }
        }
        list.push({ x, y });
    }

    return list;
}

// -------------- ブロック生成 --------------
const positions = generateNonOverlappingPositions(BLOCK_COUNT);

positions.forEach((pos, i) => {
    const block = document.createElement("div");
    block.className = "block";

    // ランダムアルファベット
    const letter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
    block.textContent = letter;

    // ランダム角度（真横以下）
    const angle = Math.random() * 30 - 15; 
    block.style.transform = `rotate(${angle}deg)`;

    // ランダム3桁数字
    const number = document.createElement("div");
    number.className = "number";
    number.textContent = Math.floor(100 + Math.random() * 900);
    block.appendChild(number);

    block.style.left = pos.x + "px";
    block.style.top = pos.y + "px";

    document.body.appendChild(block);

    animateNumber(number);
});

// -------------- 数字の隠れアニメーション --------------
function animateNumber(numElem) {
    let hidden = false;

    function cycle() {
        const waitTime = 1000 + Math.random() * 1000; // 1〜2秒

        if (!hidden) {
            // ↓ ブロックに入って隠れる
            numElem.animate(
                [
                    { transform: "translateY(0px)" },
                    { transform: "translateY(50px)" }
                ],
                { duration: 400, fill: "forwards" }
            );

            setTimeout(() => {
                numElem.style.opacity = 0; // ← ブロック内で見えなくする
                hidden = true;
                setTimeout(cycle, waitTime);
            }, 400);

        } else {
            // ↑ ブロックの外へ戻って見えるように
            numElem.style.opacity = 1;

            numElem.animate(
                [
                    { transform: "translateY(50px)" },
                    { transform: "translateY(0px)" }
                ],
                { duration: 400, fill: "forwards" }
            );

            hidden = false;
            setTimeout(cycle, waitTime);
        }
    }

    cycle();
}
</script>

</body>
</html>

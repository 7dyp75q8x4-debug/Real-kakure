<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Random Blocks Animation</title>
<style>
    body {
        margin: 0;
        background: black;
        overflow: hidden;
        font-family: monospace;
        color: white;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const BLOCK_COUNT = 50;
const BLOCK_W = 120;
const BLOCK_H = 120;

const blocks = [];

function randomLetter() {
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    return letters[Math.floor(Math.random() * letters.length)];
}
function randomNumber() {
    return String(Math.floor(100 + Math.random() * 900));
}

// ===========================
// 位置重なりチェック
// ===========================
function isOverlap(x, y) {
    for (const b of blocks) {
        if (
            x < b.x + BLOCK_W &&
            x + BLOCK_W > b.x &&
            y < b.y + BLOCK_H &&
            y + BLOCK_H > b.y
        ) {
            return true;
        }
    }
    return false;
}

// ===========================
// ブロック生成
// ===========================
for (let i = 0; i < BLOCK_COUNT; i++) {

    let x, y;
    let tries = 0;

    // ★ 重なり防止
    do {
        x = Math.random() * (canvas.width - BLOCK_W);
        y = Math.random() * (canvas.height - BLOCK_H);
        tries++;
        if (tries > 500) break;
    } while (isOverlap(x, y));

    blocks.push({
        x, y,
        angle: (Math.random() * -40),  // 真横〜上向きのランダム角度
        letter: randomLetter(),
        number: randomNumber(),
        
        // アニメーション制御
        numberY: -20,  // 初期位置（ボックス上に表示）
        state: "WAIT",
        timer: 0,
        waitTime: 1000 + Math.random() * 1000 // 1〜2秒の待ち
    });
}

// ===========================
// メインループ
// ===========================
function loop(timestamp) {

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (const b of blocks) {

        // =============== アニメーション制御 ===============
        switch (b.state) {
            case "WAIT":
                b.timer += 16;
                if (b.timer >= b.waitTime) {
                    b.timer = 0;
                    b.state = "DOWN";
                }
                break;

            case "DOWN": // 数字が下へ
                b.numberY += 6;
                if (b.numberY > BLOCK_H + 20) {
                    b.state = "HIDE";
                    b.timer = 0;
                    b.waitTime = 1000 + Math.random() * 1000;
                }
                break;

            case "HIDE": // 隠れている時間
                b.timer += 16;
                if (b.timer >= b.waitTime) {
                    b.state = "UP";
                }
                break;

            case "UP": // 上に戻る
                b.numberY -= 6;
                if (b.numberY <= -20) {
                    b.number = randomNumber(); // ★数字更新
                    b.state = "WAIT";
                    b.timer = 0;
                    b.waitTime = 1000 + Math.random() * 1000;
                }
                break;
        }

        // =============== 描画 ===============

        ctx.save();
        ctx.translate(b.x + BLOCK_W/2, b.y + BLOCK_H/2);
        ctx.rotate(b.angle * Math.PI / 180);

        // 枠
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.strokeRect(-BLOCK_W/2, -BLOCK_H/2, BLOCK_W, BLOCK_H);

        // アルファベット
        ctx.font = "48px monospace";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(b.letter, 0, 10);

        // 数字（位置は b.numberY）
        ctx.font = "32px monospace";
        ctx.fillText(b.number, 0, b.numberY - BLOCK_H/2);

        ctx.restore();
    }

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>

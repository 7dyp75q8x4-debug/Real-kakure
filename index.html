<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Block Animation</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const BLOCK_COUNT = 50;
const BLOCK_SIZE = 80;

const blocks = [];

// =========  重ならないランダム配置 ========= //
function placeBlocks() {
    let tries = 0;
    for (let i = 0; i < BLOCK_COUNT; i++) {
        let x, y;
        let safe = false;

        while (!safe && tries < 5000) {
            tries++;
            x = Math.random() * (canvas.width - BLOCK_SIZE - 100) + 50;
            y = Math.random() * (canvas.height - BLOCK_SIZE - 100) + 50;

            safe = true;
            for (let b of blocks) {
                if (Math.hypot(b.x - x, b.y - y) < BLOCK_SIZE * 1.3) {
                    safe = false;
                    break;
                }
            }
        }

        const letter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
        const number = String(Math.floor(Math.random() * 900 + 100));
        const angle = (Math.random() * 60 - 30) * Math.PI / 180; // -30°〜30°

        blocks.push({
            x, y,
            letter,
            number,
            angle,
            numberOffset: 0,
            state: "show", // show → hide → show
            timer: Date.now() + rand(1000, 2000),
        });
    }
}

function rand(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}

placeBlocks();

// ========= 数字アニメーション ========= //
function updateAnimation(block) {
    const now = Date.now();

    if (now < block.timer) return;

    if (block.state === "show") {
        block.state = "goingDown";
        block.timer = now + rand(400, 700);
    } else if (block.state === "goingDown") {
        block.state = "hidden";
        block.timer = now + rand(1000, 2000);
    } else if (block.state === "hidden") {
        block.state = "goingUp";
        block.timer = now + rand(400, 700);
    } else if (block.state === "goingUp") {
        block.state = "show";
        block.timer = now + rand(1000, 2000);
    }
}

function drawBlock(block) {
    ctx.save();
    ctx.translate(block.x, block.y);
    ctx.rotate(block.angle);

    // ---- 白いフチの四角 ----
    ctx.strokeStyle = "white";
    ctx.lineWidth = 3;
    ctx.strokeRect(-BLOCK_SIZE/2, -BLOCK_SIZE/2, BLOCK_SIZE, BLOCK_SIZE);

    // ---- アルファベット ----
    ctx.fillStyle = "white";
    ctx.font = "bold 42px monospace";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(block.letter, 0, 5);

    // ---- 数字 ----
    let offset = 0;
    if (block.state === "goingDown") offset = 40;
    if (block.state === "hidden") offset = 80;
    if (block.state === "goingUp") offset = 40;

    ctx.font = "22px monospace";
    ctx.fillText(block.number, 0, -BLOCK_SIZE/2 - 10 - offset);

    ctx.restore();
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let block of blocks) {
        updateAnimation(block);
        drawBlock(block);
    }

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
